energy_manager:
  module: energy_controller
  class: EnergyController
  dry_run_switch_entity: input_boolean.energy_controller_dry_run

  # Input sensors the controller reads from
  sensors:
    grid_power: sensor.grid_power
    battery_soc: sensor.victron_battery_soc
    battery_power: sensor.victron_system_battery_power
    solar_production: sensor.envoy_122327001496_aktuelle_stromproduktion
    miner_consumption: sensor.deiner_miner_consumption
    chp_production: sensor.96464_nm102

  # Configuration for the first device handler
  miner_heater:
    switch_entity: switch.deiner_active
    power_limit_entity: number.deiner_power_limit
    activation_threshold: 2000
    max_power: 6000
    power_step: 1000
    min_wait_time: 3

  chp_handler:
    switch_entity: switch.chp_plant # Please update this to your actual CHP switch entity
    power_draw_threshold: 1000
    min_wait_time: 3

  # Entities the controller will create/publish to
  publish_entities:
    total_surplus: sensor.controller_total_surplus
    solar_surplus: sensor.controller_solar_surplus
    chp_production: sensor.controller_chp_production
    battery_soc: sensor.controller_battery_soc
    battery_power: sensor.controller_battery_power
    battery_charging: sensor.controller_battery_charging
    battery_discharging: sensor.controller_battery_discharging
    grid_power: sensor.controller_grid_power
    grid_import: sensor.controller_grid_import
    grid_export: sensor.controller_grid_export
    solar_production: sensor.controller_solar_production
    miner_consumption: sensor.controller_miner_consumption
    miner_intended_switch_state: sensor.controller_miner_intended_switch_state
    miner_intended_power_limit: sensor.controller_miner_intended_power_limit
    chp_intended_switch_state: sensor.controller_chp_intended_switch_state
    controller_running: binary_sensor.controller_running
    last_successful_run: sensor.controller_last_successful_run
